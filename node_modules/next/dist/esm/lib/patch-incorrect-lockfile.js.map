{"version":3,"sources":["../../lib/patch-incorrect-lockfile.ts"],"names":["promises","Log","findUp","execSync","nextPkgJson","isCI","registry","fetchPkgInfo","pkg","output","toString","trim","startsWith","endsWith","_","res","fetch","ok","Error","status","data","json","versionData","versions","version","os","cpu","engines","tarball","dist","integrity","patchIncorrectLockfile","dir","process","env","NEXT_IGNORE_INCORRECT_LOCKFILE","lockfilePath","cwd","content","readFile","endingNewline","lockfileParsed","JSON","parse","lockfileVersion","parseInt","expectedSwcPkgs","Object","keys","optionalDependencies","patchDependency","pkgData","dependencies","resolved","optional","patchPackage","packages","supportedVersions","includes","shouldPatchDependencies","shouldPatchPackages","missingSwcPkgs","pkgPrefix","substring","length","push","warn","pkgsData","Promise","all","map","i","writeFile","stringify","err","error","console"],"mappings":"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"}