{"version":3,"sources":["../../server/image-optimizer.ts"],"names":["mediaType","createHash","promises","getOrientation","Orientation","imageSizeOf","isAnimated","contentDisposition","join","nodeUrl","processBuffer","decodeBuffer","getMetadata","sendEtagResponse","getContentType","getExtension","chalk","mockRequest","hasMatch","getImageBlurSvg","AVIF","WEBP","PNG","JPEG","GIF","SVG","CACHE_VERSION","ANIMATABLE_TYPES","VECTOR_TYPES","BLUR_IMG_SIZE","BLUR_QUALITY","sharp","require","process","env","NEXT_SHARP_PATH","e","showSharpMissingWarning","NODE_ENV","getSupportedMimeType","options","accept","mimeType","includes","getHash","items","hash","item","update","String","digest","replace","writeToCacheDir","dir","extension","maxAge","expireAt","buffer","etag","filename","rm","force","recursive","catch","rmdir","mkdir","writeFile","detectContentType","every","b","i","ImageOptimizerCache","validateParams","req","query","nextConfig","isDev","imageData","images","deviceSizes","imageSizes","domains","minimumCacheTTL","formats","remotePatterns","url","w","q","href","errorMessage","Array","isArray","isAbsolute","startsWith","hrefParsed","URL","toString","_error","protocol","width","parseInt","isNaN","sizes","push","isValidSize","quality","headers","isStatic","basePath","getCacheKey","constructor","distDir","cacheDir","get","cacheKey","files","readdir","now","Date","file","maxAgeSt","expireAtSt","split","readFile","Number","value","kind","revalidateAfter","Math","max","curRevalidate","isStale","_","set","revalidate","Error","err","console","error","ImageError","statusCode","message","parseCacheControl","str","map","Map","directive","key","trim","toLowerCase","getMaxAge","age","endsWith","slice","n","imageOptimizer","_req","_res","paramsResult","handleRequest","upstreamBuffer","upstreamType","upstreamRes","fetch","ok","status","Buffer","from","arrayBuffer","resBuffers","mockReq","res","mockRes","streamPromise","isStreamFinished","method","connection","parse","concat","getHeader","dangerouslyAllowSVG","vector","animate","contentType","optimizedBuffer","transformer","rotate","metaWidth","metadata","resize","avif","avifQuality","chromaSubsampling","warn","yellow","bold","webp","png","jpeg","toBuffer","output","orientation","operations","RIGHT_TOP","type","numRotations","BOTTOM_RIGHT","LEFT_BOTTOM","meta","opts","blurWidth","blurHeight","height","blurDataURL","unescape","getFileNameWithExtension","urlWithoutQueryParams","fileNameWithExtension","pop","fileName","setResponseHeaders","xCache","contentSecurityPolicy","setHeader","finished","sendResponse","result","byteLength","end","resizeImage","content","buf","resizeOperationOpts","getImageSize","Deferred","promise","Promise","resolve","reject"],"mappings":"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"}