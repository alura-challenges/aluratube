{"version":3,"sources":["../../../../server/lib/squoosh/main.ts"],"names":["Worker","path","execOnce","cpus","getWorker","resolve","__dirname","enableWorkerThreads","numWorkers","Math","max","min","length","computeWorkerKey","method","getMetadata","buffer","worker","width","height","decodeBuffer","processBuffer","operations","encoding","quality","imageData","operation","type","rotate","numRotations","opt","image","resize","Buffer","from","encodeJpeg","encodeWebp","avifQuality","encodeAvif","encodePng","Error"],"mappings":"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"}