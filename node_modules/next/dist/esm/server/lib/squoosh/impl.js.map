{"version":3,"sources":["../../../../server/lib/squoosh/impl.ts"],"names":["semver","codecs","supportedFormats","preprocessors","ImageData","FIXED_VERSION","DELAY_MS","_promise","delayOnce","ms","Promise","resolve","setTimeout","maybeDelay","isAppleM1","process","arch","platform","lt","version","decodeBuffer","_buffer","Object","buffer","Buffer","from","firstChunk","slice","firstChunkString","Array","map","v","String","fromCodePoint","join","key","entries","find","detectors","some","detector","exec","Error","encoder","mod","dec","rgba","decode","Uint8Array","rotate","image","numRotations","m","instantiate","data","width","height","resize","p","defaultOptions","encodeJpeg","quality","e","enc","r","encode","defaultEncoderOptions","encodeWebp","encodeAvif","val","autoOptimize","min","cqLevel","Math","round","encodePng"],"mappings":"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"}