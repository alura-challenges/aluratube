{"version":3,"sources":["../../server/post-process.ts"],"names":["middlewareRegistry","registerPostProcessor","name","middleware","condition","push","processHTML","html","data","options","parse","require","root","document","callMiddleWare","inspectData","inspect","mutate","i","length","FontOptimizerMiddleware","originalDom","getFontDefinition","fontDefinitions","querySelectorAll","filter","tag","getAttribute","hasAttribute","OPTIMIZED_FONT_PROVIDERS","some","url","dataHref","startsWith","forEach","element","nonce","markup","result","preconnectUrls","Set","fontDef","fallBackLinkTag","indexOf","fontContent","replace","nonceStr","escapedUrl","fontRegex","RegExp","provider","find","p","add","preconnect","preconnectTag","postProcessHTML","pathname","content","renderOpts","inAmpMode","hybridAmp","postProcessors","process","env","NEXT_RUNTIME","optimizeAmp","default","ampOptimizerConfig","ampSkipValidation","ampValidator","optimizeFonts","fontManifest","getFontDefinitionFromManifest","optimizeCss","Critters","cssOptimizer","ssrMode","reduceInlineStyles","path","distDir","publicPath","assetPrefix","preload","fonts","nonNullable","postProcessor","__NEXT_OPTIMIZE_FONTS"],"mappings":"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"}